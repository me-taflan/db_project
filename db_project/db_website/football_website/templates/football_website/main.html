{% extends "football_website/base.html" %}
{% load static %}

{% block title %}EuroSoccer{% endblock %}
{% block styles %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
{% endblock %}
{% block content %}
{% for league_name, matches in matches_data.items %}
    <div class="container-league">
        <div class="league_name">
            {{ league_name }}
        </div>
        <hr />
        {% for match in matches %}
            <div class="match {% if forloop.counter|divisibleby:2 %}dark-background{% else %}light-background{% endif %}">
                <div>{{ match.date|date:"d/m/Y" }}</div>
                <div id="score_parent">
                    <div class="home_team">
                        <a href="{% url 'football_website:team_page' team_id=match.home_id %}" class="match-link">
                            <span>{{ match.home_team_name}}</span>
                        </a>
                    </div>
                    <div id="score-outer">
                        <a href="{% url 'football_website:match_page' match_id=match.match_id %}" class="match-link">
                            <span class="score">{{ match.home_team_goal }} - {{match.away_team_goal }}</span>
                        </a>
                    </div>
                    <div class="away_team">
                        <a href="{% url 'football_website:team_page' team_id=match.away_id %}" class="match-link">
                            <span>{{ match.away_team_name}}</span>
                        </a>
                    </div>
                </div>
                <button class="fav" data-match-id="{{ match.match_id }}">Add to Favorites</button>
            </div>
        {% endfor %}
    </div>
{% endfor %}

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
  $(document).ready(function () {
      $('.fav').click(function () {
          var matchId = $(this).data('match-id');
          var username = '{{ request.session.username }}';  // Assuming you set the username in the session
          var url = '/add_favorite_match/' + matchId + '/' + username + '/';
          $.post({
              url: url,
              data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
              success: function () {
                  alert('Match added to favorites!');
                  // You can update the UI here if needed
              },
              error: function () {
                  alert('Please login to add favorites.');
              }
          });
      });
  });
</script>
{% endblock %}
